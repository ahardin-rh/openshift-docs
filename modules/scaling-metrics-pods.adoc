// Module included in the following assemblies:
//
// scalability_and_performance/scaling-cluster-metrics-components.adoc

[id='scaling_metrics_pods']
= Scaling {product-title} metrics pods
One set of metrics pods (Cassandra/Hawkular/Heapster) is able to monitor at least 25,000 pods.

.Prerequisites

* If persistent storage was used to deploy {product-title} metrics, then you must
create a persistent volume (PV) for the new Cassandra pod to use before you can
scale out the number of {product-title} metrics Cassandra pods. However, if
Cassandra was deployed with dynamically provisioned PVs, then this step is not
necessary.

[IMPORTANT]
====
Cassandra nodes use persistent storage. Therefore, scaling up or down is not
possible with replication controllers.

Scaling a Cassandra cluster requires modifying the
`openshift_metrics_cassandra_replicas` variable and re-running the deployment. By
default, the Cassandra cluster is a single-node cluster.
====

.Procedure

*Scaling up*

. To scale up the number of {product-title} metrics hawkular pods to two replicas,
run:
+
----
# oc scale -n openshift-infra --replicas=2 rc hawkular-metrics
----
+
Alternatively, update your inventory file and re-run the deployment.

[NOTE]
====
If you add a new node to or remove an existing node from a Cassandra cluster,
the data stored in the cluster rebalances across the cluster.
====

*Scaling down*

. If remotely accessing the container, run the following for the Cassandra node
you want to remove:
+
----
$ oc exec -it <hawkular-cassandra-pod> nodetool decommission
----
+
If locally accessing the container, run the following instead:
+
----
$ oc rsh <hawkular-cassandra-pod> nodetool decommission
----
+
This command can take a while to run since it copies data across the cluster.
You can monitor the decommission progress with `nodetool netstats -H`.

. Once the previous command succeeds, scale down the `rc` for the Cassandra
instance to `0`:
+
----
# oc scale -n openshift-infra --replicas=0 rc <hawkular-cassandra-rc>
----
+
This will remove the Cassandra pod.

[IMPORTANT]
====
If the scale down process completed and the existing Cassandra nodes are
functioning as expected, you can also delete the rc for this Cassandra instance
and its corresponding persistent volume claim (PVC). Deleting the PVC can
permanently delete any data associated with this Cassandra instance, so if the
scale down did not fully and successfully complete, you will not be able to
recover the lost data.
====
